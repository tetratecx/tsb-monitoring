{
    "annotations": {
        "list": [
            {
                "builtIn": 1,
                "datasource": {
                    "type": "datasource",
                    "uid": "grafana"
                },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "target": {
                    "limit": 100,
                    "matchAny": false,
                    "tags": [],
                    "type": "dashboard"
                },
                "type": "dashboard"
            }
        ]
    },
    "description": "Operational metrics for istiod health.",
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 1,
    "id": 3,
    "links": [],
    "liveNow": false,
    "panels": [
        {
            "collapsed": false,
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 0
            },
            "id": 639,
            "panels": [],
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "refId": "A"
                }
            ],
            "title": "At a Glance",
            "type": "row"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "Count of Envoys connected to istiod. This should represent the total number of endpoints in the selected cluster.\n\nIf this number significantly decreases for longer than 5 minutes without an obvious reason (e.g. a scale-down event) then you should investigate. This may indicate that Envoys have been disconnected from istiod and are unable to reconnect.",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "fixedColor": "rgb(31, 120, 193)",
                        "mode": "fixed"
                    },
                    "mappings": [
                        {
                            "options": {
                                "match": "null",
                                "result": {
                                    "text": "N/A"
                                }
                            },
                            "type": "special"
                        }
                    ],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    },
                    "unit": "none"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 5,
                "x": 0,
                "y": 1
            },
            "id": 637,
            "links": [],
            "maxDataPoints": 100,
            "options": {
                "colorMode": "none",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "horizontal",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "/^Count$/",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "9.1.7",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(pilot_xds{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"})",
                    "legendFormat": "Count",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "Connected Envoys",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "The total error rate for Istio when configuring Envoy, including generation and transport errors.\n\nAny errors (current and historic) should be investigated using the more detailed split below.",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [
                        {
                            "options": {
                                "match": "null",
                                "result": {
                                    "color": "#299c46",
                                    "text": "0"
                                }
                            },
                            "type": "special"
                        }
                    ],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "#299c46",
                                "value": null
                            },
                            {
                                "color": "rgba(237, 129, 40, 0.89)",
                                "value": 1
                            },
                            {
                                "color": "#d44a3a",
                                "value": 2
                            }
                        ]
                    },
                    "unit": "cps"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 5,
                "x": 5,
                "y": 1
            },
            "id": 642,
            "links": [],
            "maxDataPoints": 100,
            "options": {
                "colorMode": "background",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "horizontal",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "9.1.7",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(pilot_xds_write_timeout{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) +\nsum(rate(pilot_total_xds_internal_errors{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) +\nsum(rate(pilot_total_xds_rejects{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) +\nsum(rate(pilot_xds_expired_nonce{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) +  \nsum(rate(pilot_xds_push_context_errors{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) +  \nsum(rate(pilot_xds_pushes{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\",type=~\".*_senderr\"}[1m]))\nOR on() vector(0)",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "Total Error Rate",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "The median (50th percentile) delay between istiod receiving configuration changes and the proxy receiving all required configuration in the selected cluster. This number indicates how stale the proxy configuration is. As this number increases, it may start to impact application traffic.\n\nThis number is typically in the hundreds of milliseconds. In small clusters, this number may be zero.\n\nIf this number creeps up to 30s for an extended period, istiod likely needs to be scaled out (or up).",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [
                        {
                            "options": {
                                "match": "null",
                                "result": {
                                    "text": ""
                                }
                            },
                            "type": "special"
                        }
                    ],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "#299c46",
                                "value": null
                            },
                            {
                                "color": "rgba(237, 129, 40, 0.89)",
                                "value": 15
                            },
                            {
                                "color": "#d44a3a",
                                "value": 30
                            }
                        ]
                    },
                    "unit": "dtdurations"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 5,
                "x": 10,
                "y": 1
            },
            "id": 641,
            "links": [],
            "maxDataPoints": 100,
            "options": {
                "colorMode": "background",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "horizontal",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "9.1.7",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "histogram_quantile(0.5, sum(rate(pilot_proxy_convergence_time_bucket{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) by (le))",
                    "instant": false,
                    "refId": "A"
                }
            ],
            "title": "Median Proxy Convergence Time",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "Time remaining until expiration of the Istiod root CA (displayed as 'days hours:minutes:seconds'). The value will turn yellow (warning) when the time to expiration is less than 6 month, and will turn red (critical) when it expires in less than a month.",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "semi-dark-red",
                                "value": 2630000
                            },
                            {
                                "color": "semi-dark-orange",
                                "value": 15780000
                            },
                            {
                                "color": "semi-dark-green",
                                "value": 15780001
                            }
                        ]
                    },
                    "unit": "dtdhms"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 4,
                "x": 15,
                "y": 1
            },
            "id": 644,
            "options": {
                "colorMode": "background",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "9.1.7",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "citadel_server_root_cert_expiry_timestamp{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"} - time()",
                    "format": "time_series",
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "Time to Root CA expiration",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "Time remaining until expiration of the Istiod certificate chain (the certificates istiod uses to sign workload certificates). The value will turn yellow (warning) when the time to expiration is less than 6 month, and will turn red (critical) when it expires in less than a month.\n\nIf this shows no value, it means your istiod instances are using a self-signed certificate or a root CA certificate to issue workload certificates, instead of using an intermediate CA. If that is the case, this panel is meaningless to you, but you should consider using an intermediate CA for your istio control planes.",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "semi-dark-red",
                                "value": 2630000
                            },
                            {
                                "color": "semi-dark-orange",
                                "value": 15780000
                            },
                            {
                                "color": "semi-dark-green",
                                "value": 15780001
                            }
                        ]
                    },
                    "unit": "dtdhms"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 4,
                "x": 19,
                "y": 1
            },
            "id": 645,
            "options": {
                "colorMode": "background",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "9.1.7",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "exemplar": false,
                    "expr": "citadel_server_cert_chain_expiry_timestamp{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"} - time()",
                    "format": "time_series",
                    "instant": true,
                    "interval": "",
                    "legendFormat": "__auto",
                    "range": false,
                    "refId": "A"
                }
            ],
            "title": "Time to cert chain expiration",
            "type": "stat"
        },
        {
            "collapsed": false,
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 5
            },
            "id": 647,
            "panels": [],
            "title": "Envoy Filter Status",
            "type": "row"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "Number of successfully applied Envoy Filters in the cluster.",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "fixedColor": "green",
                        "mode": "fixed"
                    },
                    "mappings": [],
                    "noValue": "0",
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 4,
                "x": 0,
                "y": 6
            },
            "id": 649,
            "options": {
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "showThresholdLabels": false,
                "showThresholdMarkers": false
            },
            "pluginVersion": "9.1.7",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(pilot_envoy_filter_status{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\",result=\"applied\"})",
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "Applied Envoy Filters",
            "type": "gauge"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "Number of Envoy Filters in the cluster that failed to apply.",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "fixedColor": "red",
                        "mode": "fixed"
                    },
                    "mappings": [],
                    "noValue": "0",
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 4,
                "x": 4,
                "y": 6
            },
            "id": 650,
            "options": {
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "showThresholdLabels": false,
                "showThresholdMarkers": false
            },
            "pluginVersion": "9.1.7",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(pilot_envoy_filter_status{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\",result=\"error\"})",
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "Errored Envoy Filters",
            "type": "gauge"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "Status of each Envoy Filter in the cluster (applied/error).",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "fixedColor": "transparent",
                        "mode": "fixed"
                    },
                    "custom": {
                        "align": "auto",
                        "displayMode": "color-background",
                        "inspect": false
                    },
                    "mappings": [
                        {
                            "options": {
                                "applied": {
                                    "color": "green",
                                    "index": 0
                                },
                                "error": {
                                    "color": "red",
                                    "index": 1
                                }
                            },
                            "type": "value"
                        }
                    ],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    }
                },
                "overrides": [
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "namespace/name"
                        },
                        "properties": [
                            {
                                "id": "custom.width",
                                "value": 397
                            }
                        ]
                    }
                ]
            },
            "gridPos": {
                "h": 8,
                "w": 15,
                "x": 8,
                "y": 6
            },
            "id": 652,
            "options": {
                "footer": {
                    "fields": "",
                    "reducer": [
                        "sum"
                    ],
                    "show": false
                },
                "showHeader": true,
                "sortBy": []
            },
            "pluginVersion": "9.1.7",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "pilot_envoy_filter_status{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}",
                    "format": "table",
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "Envoy Filter status",
            "transformations": [
                {
                    "id": "groupingToMatrix",
                    "options": {
                        "columnField": "patch",
                        "rowField": "name",
                        "valueField": "result"
                    }
                },
                {
                    "id": "organize",
                    "options": {
                        "excludeByName": {
                            "Field 3": true
                        },
                        "indexByName": {},
                        "renameByName": {
                            "name\\patch": "namespace/name"
                        }
                    }
                }
            ],
            "type": "table"
        },
        {
            "collapsed": false,
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 14
            },
            "id": 58,
            "panels": [],
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "refId": "A"
                }
            ],
            "title": "Istiod Push Information",
            "type": "row"
        },
        {
            "aliasColors": {},
            "bars": false,
            "dashLength": 10,
            "dashes": false,
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "The rate of istiod pushes to Envoy grouped by discovery service. Istiod pushes clusters (CDS), endpoints (EDS), listeners (LDS) or routes (RDS) any time it receives a configuration change. \n\nChanges are triggered by a user interacting with TSB or a change in infrastructure such as a new endpoint (service instance/pod) creation.\n\nIn small relatively static clusters these values can be zero most of the time.",
            "fieldConfig": {
                "defaults": {
                    "links": []
                },
                "overrides": []
            },
            "fill": 1,
            "fillGradient": 0,
            "gridPos": {
                "h": 8,
                "w": 8,
                "x": 0,
                "y": 15
            },
            "hiddenSeries": false,
            "id": 632,
            "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": true,
                "hideZero": true,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
            },
            "lines": true,
            "linewidth": 1,
            "nullPointMode": "null as zero",
            "options": {
                "alertThreshold": true
            },
            "percentage": false,
            "pluginVersion": "9.1.7",
            "pointradius": 2,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "spaceLength": 10,
            "stack": false,
            "steppedLine": false,
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(irate(pilot_xds_pushes{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\",type=~\"cds|eds|rds|lds\"}[1m])) by (type)",
                    "legendFormat": "{{type}}",
                    "range": true,
                    "refId": "A"
                }
            ],
            "thresholds": [],
            "timeRegions": [],
            "title": "Istiod Push Rate",
            "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
            },
            "type": "graph",
            "xaxis": {
                "mode": "time",
                "show": true,
                "values": []
            },
            "yaxes": [
                {
                    "$$hashKey": "object:242",
                    "format": "reqps",
                    "logBase": 1,
                    "min": "0",
                    "show": true
                },
                {
                    "$$hashKey": "object:243",
                    "format": "short",
                    "logBase": 1,
                    "show": true
                }
            ],
            "yaxis": {
                "align": false
            }
        },
        {
            "aliasColors": {},
            "bars": false,
            "dashLength": 10,
            "dashes": false,
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "The different error rates for Istio during general operations. Including the generation and distribution of Envoy configuration.\n\n`pilot_xds_write_timeout`\nRate of connection timeouts between Envoy and istiod. This number indicates that an Envoy has taken too long to acknowledge a configuration change from Istio. An increase in these errors typically indicates network issues, envoy resource limits or istiod resource limits (usually cpu)\n\n`pilot_total_xds_internal_errors`\nRate of errors thrown inside istiod whilst generating Envoy configuration. Check the istiod logs for more details if you see internal errors.\n\n`pilot_total_xds_rejects`\nRate of rejected configuration from Envoy. Istio should never produce any invalid Envoy configuration so any errors here warrants investigation, starting with the istiod logs.\n\n`pilot_xds_expired_nonce`\nRate of expired nonces from Envoys. This number indicates that an Envoy has responded to the wrong request sent from Istio. An increase in these errors typically indicates network issues (saturation or partition), Envoy resource limits or istiod resource limits (usually cpu).\n\n`pilot_xds_push_context_errors`\nRate of errors setting a connection with an Envoy instance. An increase in these errors typically indicates network issues (saturation or partition), Envoy resource limits or istiod resource limits (usually cpu). Check istiod logs for further details.\n\n`pilot_xds_pushes`\nRate of transport errors sending configuration to Envoy.  An increase in these errors typically indicates network issues (saturation or partition), Envoy resource limits or istiod resource limits (usually cpu).",
            "fieldConfig": {
                "defaults": {
                    "links": []
                },
                "overrides": []
            },
            "fill": 1,
            "fillGradient": 0,
            "gridPos": {
                "h": 8,
                "w": 8,
                "x": 8,
                "y": 15
            },
            "hiddenSeries": false,
            "id": 634,
            "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
            },
            "lines": true,
            "linewidth": 1,
            "nullPointMode": "null as zero",
            "options": {
                "alertThreshold": true
            },
            "percentage": false,
            "pluginVersion": "9.1.7",
            "pointradius": 2,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "spaceLength": 10,
            "stack": false,
            "steppedLine": false,
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(pilot_xds_write_timeout{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m]))",
                    "legendFormat": "Write Timeouts",
                    "range": true,
                    "refId": "A"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(pilot_total_xds_internal_errors{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m]))",
                    "legendFormat": "Internal Errors",
                    "range": true,
                    "refId": "B"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(pilot_total_xds_rejects{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m]))",
                    "legendFormat": "Config Rejections",
                    "range": true,
                    "refId": "C"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(pilot_xds_expired_nonce{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m]))",
                    "legendFormat": "Expired Nonce",
                    "range": true,
                    "refId": "D"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(pilot_xds_push_context_errors{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m]))",
                    "legendFormat": "Push Context Errors",
                    "range": true,
                    "refId": "F"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(pilot_xds_pushes{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\",type=~\".*_senderr\"}[1m])) by (type)",
                    "legendFormat": "Send Failures {{ type }}",
                    "range": true,
                    "refId": "E"
                }
            ],
            "thresholds": [],
            "timeRegions": [],
            "title": "Istiod Error Rate",
            "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
            },
            "type": "graph",
            "xaxis": {
                "mode": "time",
                "show": true,
                "values": []
            },
            "yaxes": [
                {
                    "$$hashKey": "object:318",
                    "format": "reqps",
                    "logBase": 1,
                    "min": "0",
                    "show": true
                },
                {
                    "$$hashKey": "object:319",
                    "format": "short",
                    "logBase": 1,
                    "show": true
                }
            ],
            "yaxis": {
                "align": false
            }
        },
        {
            "aliasColors": {},
            "bars": false,
            "dashLength": 10,
            "dashes": false,
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "The delay between an istiod receiving configuration changes and a proxy receiving all required configuration in the cluster. Broken down by percentiles.\n\nThis number indicates how stale the proxy configuration is. As this number increases it may start to affect application traffic.\n\nThis number is typically in the hundreds of milliseconds. If this number creeps up to 30s for an extended period of time, it is likely that istiod needs to be scaled out (or up) as it is likely pinned up against its CPU limits.",
            "fieldConfig": {
                "defaults": {
                    "links": []
                },
                "overrides": []
            },
            "fill": 1,
            "fillGradient": 0,
            "gridPos": {
                "h": 8,
                "w": 8,
                "x": 16,
                "y": 15
            },
            "hiddenSeries": false,
            "id": 635,
            "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
            },
            "lines": true,
            "linewidth": 1,
            "nullPointMode": "null as zero",
            "options": {
                "alertThreshold": true
            },
            "percentage": false,
            "pluginVersion": "9.1.7",
            "pointradius": 2,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "spaceLength": 10,
            "stack": false,
            "steppedLine": false,
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "histogram_quantile(0.5, sum(rate(pilot_proxy_convergence_time_bucket{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) by (le))",
                    "legendFormat": "P50",
                    "range": true,
                    "refId": "B"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "histogram_quantile(0.90, sum(rate(pilot_proxy_convergence_time_bucket{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) by (le))",
                    "legendFormat": "P90",
                    "range": true,
                    "refId": "A"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "histogram_quantile(0.99, sum(rate(pilot_proxy_convergence_time_bucket{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m])) by (le))",
                    "legendFormat": "P99",
                    "range": true,
                    "refId": "C"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "expr": "histogram_quantile(0.999, sum(rate(pilot_proxy_convergence_time_bucket{cluster_name=\"$cluster\"}[1m])) by (le))",
                    "legendFormat": "P99.9",
                    "refId": "D"
                }
            ],
            "thresholds": [],
            "timeRegions": [],
            "title": "Proxy Convergence Time",
            "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
            },
            "type": "graph",
            "xaxis": {
                "mode": "time",
                "show": true,
                "values": []
            },
            "yaxes": [
                {
                    "format": "s",
                    "logBase": 1,
                    "min": "0",
                    "show": true
                },
                {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                }
            ],
            "yaxis": {
                "align": false
            }
        },
        {
            "collapsed": false,
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 23
            },
            "id": 626,
            "panels": [],
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "refId": "A"
                }
            ],
            "title": "Webhooks",
            "type": "row"
        },
        {
            "aliasColors": {},
            "bars": false,
            "dashLength": 10,
            "dashes": false,
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "Success and failure rate of `istio` configuration validation requests. This is triggered when TSB configuration is created or updated.\n\nAny failures here should be investigated in the istiod and `edge` logs.\n\nIf there are TSB configuration changes being made that affect the selected cluster and the success number is zero then there is an issue with configuration propagation. Check the XCP `edge` logs to debug further.",
            "fieldConfig": {
                "defaults": {
                    "links": []
                },
                "overrides": []
            },
            "fill": 1,
            "fillGradient": 0,
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 24
            },
            "hiddenSeries": false,
            "id": 629,
            "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
            },
            "lines": true,
            "linewidth": 1,
            "nullPointMode": "null as zero",
            "options": {
                "alertThreshold": true
            },
            "percentage": false,
            "pluginVersion": "9.1.7",
            "pointradius": 2,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "spaceLength": 10,
            "stack": false,
            "steppedLine": false,
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(galley_validation_passed{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m]))",
                    "interval": "",
                    "legendFormat": "Validations (Success)",
                    "range": true,
                    "refId": "A"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "expr": "sum(rate(galley_validation_failed{cluster_name=\"$cluster\"}[1m]))",
                    "interval": "",
                    "legendFormat": "Validation (Failure)",
                    "refId": "B"
                }
            ],
            "thresholds": [],
            "timeRegions": [],
            "title": "Configuration Validation",
            "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
            },
            "type": "graph",
            "xaxis": {
                "mode": "time",
                "show": true,
                "values": []
            },
            "yaxes": [
                {
                    "$$hashKey": "object:122",
                    "format": "reqps",
                    "logBase": 1,
                    "min": "0",
                    "show": true
                },
                {
                    "$$hashKey": "object:123",
                    "format": "short",
                    "logBase": 1,
                    "show": true
                }
            ],
            "yaxis": {
                "align": false
            }
        },
        {
            "aliasColors": {},
            "bars": false,
            "dashLength": 10,
            "dashes": false,
            "datasource": {
                "type": "prometheus",
                "uid": "P1809F7CD0C75ACF3"
            },
            "description": "Rate of sidecar injection requests. Sidecar injection is triggered whenever a new instance/pod is created.\n\nAny errors displayed here should be investigated further by checking the istiod logs.",
            "fieldConfig": {
                "defaults": {
                    "links": []
                },
                "overrides": []
            },
            "fill": 1,
            "fillGradient": 0,
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 24
            },
            "hiddenSeries": false,
            "id": 630,
            "legend": {
                "avg": false,
                "current": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
            },
            "lines": true,
            "linewidth": 1,
            "nullPointMode": "null as zero",
            "options": {
                "alertThreshold": true
            },
            "percentage": false,
            "pluginVersion": "9.1.7",
            "pointradius": 2,
            "points": false,
            "renderer": "flot",
            "seriesOverrides": [],
            "spaceLength": 10,
            "stack": false,
            "steppedLine": false,
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "editorMode": "code",
                    "expr": "sum(rate(sidecar_injection_success_total{cluster_name=\"$cluster\",istio_revision=\"$istio_revision\"}[1m]))",
                    "interval": "",
                    "legendFormat": "Injections (Success)",
                    "range": true,
                    "refId": "A"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "P1809F7CD0C75ACF3"
                    },
                    "expr": "sum(rate(sidecar_injection_failure_total{cluster_name=\"$cluster\"}[1m]))",
                    "interval": "",
                    "legendFormat": "Injections (Failure)",
                    "refId": "B"
                }
            ],
            "thresholds": [],
            "timeRegions": [],
            "title": "Sidecar Injection",
            "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
            },
            "type": "graph",
            "xaxis": {
                "mode": "time",
                "show": true,
                "values": []
            },
            "yaxes": [
                {
                    "format": "reqps",
                    "logBase": 1,
                    "min": "0",
                    "show": true
                },
                {
                    "format": "short",
                    "logBase": 1,
                    "show": true
                }
            ],
            "yaxis": {
                "align": false
            }
        }
    ],
    "refresh": "1m",
    "schemaVersion": 37,
    "style": "dark",
    "tags": [
        "tsb",
        "istiod"
    ],
    "templating": {
        "list": [
            {
                "current": {
                    "selected": false,
                    "text": "app-cluster-1",
                    "value": "app-cluster-1"
                },
                "datasource": {
                    "type": "prometheus",
                    "uid": "P1809F7CD0C75ACF3"
                },
                "definition": "label_values(cluster_name)",
                "hide": 0,
                "includeAll": false,
                "label": "Cluster",
                "multi": false,
                "name": "cluster",
                "options": [],
                "query": {
                    "query": "label_values(cluster_name)",
                    "refId": "prometheus-cluster-Variable-Query"
                },
                "refresh": 2,
                "regex": "",
                "skipUrlSync": false,
                "sort": 0,
                "tagValuesQuery": "",
                "tagsQuery": "",
                "type": "query",
                "useTags": false
            },
            {
                "current": {
                    "selected": false,
                    "text": "default",
                    "value": "default"
                },
                "datasource": {
                    "type": "prometheus",
                    "uid": "P1809F7CD0C75ACF3"
                },
                "definition": "label_values(istio_revision)",
                "hide": 0,
                "includeAll": false,
                "label": "Istio Revision",
                "multi": false,
                "name": "istio_revision",
                "options": [],
                "query": {
                    "query": "label_values(istio_revision)",
                    "refId": "StandardVariableQuery"
                },
                "refresh": 2,
                "regex": "",
                "skipUrlSync": false,
                "sort": 0,
                "tagValuesQuery": "",
                "tagsQuery": "",
                "type": "query",
                "useTags": false
            }
        ]
    },
    "time": {
        "from": "now-1h",
        "to": "now"
    },
    "timepicker": {
        "refresh_intervals": [
            "5s",
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
        ],
        "time_options": [
            "5m",
            "15m",
            "1h",
            "6h",
            "12h",
            "24h",
            "2d",
            "7d",
            "30d"
        ]
    },
    "timezone": "utc",
    "title": "Istio Operational Status",
    "uid": "pkXuEvqIk",
    "version": 2,
    "weekStart": ""
}
